# Project Rules: Packaged Framework Development

## 1. Objective

This document outlines the development workflow and key concepts for working with the `aurite` package, which is the distributable version of the Aurite Agents framework. It focuses on how the package is built, how the `aurite init` command works, and the process for modifying the files and templates that are scaffolded for end-users.

## 2. Core Concepts

The `aurite` package is designed to provide a simple and consistent way for users to start building with the framework. The central mechanism for this is the `aurite init` command, which creates a standardized project structure pre-populated with example configurations and scripts.

-   **Package-First Mentality:** When making changes intended for end-users of the package, we must consider how those changes will be experienced after they run `pip install aurite`.
-   **Scaffolding:** The `aurite init` command scaffolds a new project by copying a set of template files and directories. These source templates are located within the `src/aurite/packaged/` directory in the repository.
-   **Path Resolution:** The framework resolves all user-configured paths (for components, custom workflows, MCP servers, etc.) relative to the `current_project_root`, which is defined as the directory containing the main `aurite_config.json` file.

## 3. Key Files & Scripts for Packaging

Understanding these files is crucial for modifying the package's behavior.

| File/Directory                      | Purpose                                                                                                                                                                                                                         |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `pyproject.toml`                    | Defines the package metadata (`name`, `version`, `dependencies`) and, most importantly, the command-line scripts. The `[project.scripts]` section maps the `aurite` command to the `aurite.cli.main:app` Typer application.        |
| `MANIFEST.in`                       | Instructs the build system to include non-Python files in the package. The `graft src/aurite/packaged` command is critical; it ensures the entire directory of template files is included in the final distributable package. |
| `src/aurite/packaged/`              | This directory is the **source of truth** for all files and templates that the `aurite init` command scaffolds into a new user project. Any changes to the initial user experience must be made here.                           |
| `src/aurite/bin/cli/main.py`        | Contains the logic for the `aurite` CLI. The `init` function defines the step-by-step process of creating the project directory, subdirectories, and copying all the template files from `src/aurite/packaged/`.                 |
| `src/aurite/bin/cli/studio_server.py` | Contains the logic for the `aurite studio` command. It starts a FastAPI server to serve the static frontend UI, which is also included in the package from `src/aurite/packaged/static_ui/`.                                     |
| `src/aurite/py.typed`               | A marker file that signals to type checkers (like MyPy) that the `aurite` package provides inline type information, enabling better static analysis for developers using the package.                                            |

## 4. The `aurite init` Workflow

The `aurite init` command is the primary entry point for a new user.

1.  **Execution:** A user runs `aurite init <project_name>` in their terminal.
2.  **Logic:** The `init` function in `src/aurite/bin/cli/main.py` is executed.
3.  **Scaffolding:** The function performs the following actions:
    *   Creates the main project directory (e.g., `my_first_aurite_project/`).
    *   Copies the default `aurite_config.json` from `src/aurite/packaged/component_configs/projects/default_project.json`.
    *   Creates the standard subdirectory structure (`config/`, `mcp_servers/`, `custom_workflows/`).
    *   Copies all example JSON configurations, Python scripts, and other assets from `src/aurite/packaged/` into the corresponding new directories.
4.  **Result:** The user is left with a fully-formed, runnable project structure as described in `README_packaged.md` and `docs/package_installation_guide.md`.

## 5. Development Workflow for Package Changes

To modify the files or structure generated by `aurite init`, follow this process:

1.  **Identify the Source File:** Locate the file you want to change within the `src/aurite/packaged/` directory.
    *   *Example:* To change the default agent configuration, you would edit `src/aurite/packaged/component_configs/agents/example_agents.json`.
    *   *Example:* To change the logic of the example run script, you would edit `src/aurite/packaged/run_test_project.py`.

2.  **Make Modifications:** Edit the source file(s) directly within `src/aurite/packaged/`.

3.  **Test the Changes:** To test the effect of your changes on the `aurite init` command, you must reinstall the package in your local development environment so that the updated packaged files are recognized.
    *   From the root of the `aurite-agents` repository, run:
        ```bash
        pip install -e .
        ```
    *   This command installs the package in "editable" mode, meaning your changes to the source files (including those in `src/aurite/packaged/`) will be reflected when you run the `aurite` command.

4.  **Verify the Output:**
    *   Create a temporary directory outside of the repository to test in.
    *   Run `aurite init test_project`.
    *   Inspect the generated `test_project/` directory to ensure your changes have been correctly scaffolded.

5.  **Update Documentation:** If the changes affect the user-facing structure, configuration, or behavior, update the relevant documentation, primarily `README_packaged.md` and `docs/package_installation_guide.md`.
